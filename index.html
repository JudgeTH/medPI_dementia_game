<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#4CAF50" />

  <!-- PWA Meta Tags -->
  <link rel="manifest" href="manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="‡πÄ‡∏Å‡∏°‡∏ù‡∏∂‡∏Å‡∏™‡∏°‡∏≠‡∏á" />

  <title>‡πÄ‡∏Å‡∏°‡∏ù‡∏∂‡∏Å‡∏™‡∏°‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</title>

  <!-- CSS Files (‡∏Ñ‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ‡∏ï‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå) -->
  <link rel="stylesheet" href="css/reset.css" />
  <link rel="stylesheet" href="css/variables.css" />
  <link rel="stylesheet" href="css/base.css" />
  <link rel="stylesheet" href="css/components.css" />
  <link rel="stylesheet" href="css/animations.css" />
  <link rel="stylesheet" href="css/responsive.css" />

  <!-- Combined UI Hotfix (clean) -->
  <style>
    /* ===== Character layout: info ‡∏ã‡πâ‡∏≤‡∏¢ / ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ ‡∏Ç‡∏ß‡∏≤ ===== */
    #image-character-container .character-display-area{
      display:flex;
      justify-content:space-between;
      align-items:center;
      width:92%;
      max-width:980px;
      padding:0 16px;
    }
    #image-character-container .character-info.in-stage{ 
      order:1; 
      text-align:left; 
      max-width:240px; 
    }
    #image-character-container .character-container{ 
      order:2; 
      width:220px !important; 
      height:330px !important; 
    }

    /* ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô/‡∏õ‡πâ‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ */
    #image-character-container .character-nameplate h3{ 
      font-size:3.5rem !important; 
      letter-spacing:.2px; 
    }

    /* ‡πÅ‡∏ñ‡∏ß‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ‚Äì ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô */
    #image-character-container .character-stats{ gap:10px !important; }
    #image-character-container .stat-item{ font-size:1.1rem !important; }
    #image-character-container .stat-icon{
      font-size:1.6rem !important;
      min-width:26px !important;
    }
    #image-character-container .stat-label{ font-weight:600; }
    #image-character-container .stat-value{ font-size:1.35rem !important; }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå ‚Äì ‡∏Å‡∏î‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô */
    #image-character-container .emotion-controls{ gap:12px !important; }
    #image-character-container .emotion-btn{
      width:52px !important;
      height:52px !important;
      font-size:1.35rem !important;
    }

    /* ‡∏ï‡∏±‡∏î‡πÄ‡∏á‡∏≤‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ + ‡∏Ç‡∏¢‡∏≤‡∏¢ */
    #image-character-container .character-shadow{ display:none !important; }
    #image-character-container .character-container{
      width:240px !important;
      height:360px !important;
    }

    /* ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ß‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏Å‡∏≤‡∏£‡πå‡∏î */
    .action-buttons{ padding-left:16px !important; padding-right:16px !important; }
    .action-grid{
      display:grid !important;
      grid-template-columns:repeat(2,1fr) !important;
      gap:16px !important;
    }
    .action-card{
      min-height:140px !important;
      padding:16px 14px !important;
      border-radius:16px !important;
      box-shadow:0 2px 8px rgba(0,0,0,.06) !important;
    }
    .action-card .action-icon{
      font-size:10.2rem !important;
      margin-bottom:10px !important;
      line-height:1 !important;
    }
    .action-card h3{ font-size:1.3rem !important; margin:6px 0 4px !important; }
    .action-card p{ font-size:.95rem !important; opacity:.85; }

    /* ====== Mobile (‚â§768px) ====== */
    @media (max-width:768px){
      #image-character-container{ height:480px !important; }
      #image-character-container .character-container{
        width:220px !important;
        height:330px !important;
      }
      #image-character-container .character-nameplate h3{ font-size:2.35rem !important; }
      #image-character-container .stat-item{ font-size:1.05rem !important; }
      #image-character-container .stat-icon{ font-size:1.5rem !important; min-width:24px !important; }
      #image-character-container .stat-value{ font-size:1.3rem !important; }
      #image-character-container .emotion-btn{
        width:48px !important; height:48px !important; font-size:1.25rem !important;
      }

      .action-buttons{ padding-left:18px !important; padding-right:18px !important; }
      .action-grid{ gap:14px !important; }
      .action-card{
        min-height:150px !important;
        padding:18px 16px !important;
      }
      .action-card .action-icon{ font-size:2.4rem !important; }
      .action-card h3{ font-size:1.35rem !important; }
    }
      /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô */
    .action-card{
      background-color: #EAF4FF !important;   /* ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô */
      border: 1px solid #CFE3FF !important;
      box-shadow: 0 2px 8px rgba(14, 35, 69, 0.08) !important; /* ‡πÄ‡∏á‡∏≤‡∏≠‡πà‡∏≠‡∏ô‡πÇ‡∏ó‡∏ô‡∏ü‡πâ‡∏≤ */
    }
    .action-card h3{
      color: #0A2540 !important;   /* ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏°‡∏≠‡πà‡∏≤‡∏ô‡∏ä‡∏±‡∏î */
    }
    .action-card p{
      color: #1F2A44 !important;   /* ‡∏ï‡∏±‡∏ß‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î */
      opacity: 1 !important;       /* ‡πÄ‡∏≠‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏°‡∏ä‡∏±‡∏î */
    }
    .action-card .action-icon{
      opacity: 1 !important;       /* ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ä‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô */
    }
  
    /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÇ‡∏Æ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
    .action-card:hover{
      background-color: #E3F0FF !important;   /* ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏ï‡∏≠‡∏ô‡πÇ‡∏Æ‡πÄ‡∏ß‡∏≠‡∏£‡πå */
      transform: translateY(-1px);
      transition: background-color .2s ease, transform .2s ease, box-shadow .2s ease;
      box-shadow: 0 6px 18px rgba(14, 35, 69, 0.12) !important;
    }
  
    /* ‡∏õ‡πâ‡∏≤‡∏¢ "‡πÉ‡∏´‡∏°‡πà!" ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡πâ‡∏≤‡∏¢‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Å‡∏° ‡πÉ‡∏´‡πâ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÇ‡∏î‡∏î‡πÄ‡∏î‡πà‡∏ô */
    .action-card .action-badge{
      background: #D7EAFF !important;
      color: #0A2540 !important;
      border: 1px solid #BEDBFF !important;
    }
  
    /* ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏î: ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */
    @media (prefers-color-scheme: dark){
      .action-card{
        background-color: #DAECFF !important;
        border-color: #BFD8FF !important;
        box-shadow: 0 2px 10px rgba(0,0,0,.25) !important;
      }
      .action-card:hover{
        background-color: #D1E6FF !important;
      }
    }
  </style>
</head>
<body>
  <!-- ‡∏´‡∏ô‡πâ‡∏≤ Login/Welcome -->
  <div id="login-page" class="page active">
    <div class="container">
      <header class="header">
        <h1 class="game-title">üß† ‡πÄ‡∏Å‡∏°‡∏ù‡∏∂‡∏Å‡∏™‡∏°‡∏≠‡∏á</h1>
        <p class="game-subtitle">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</p>
      </header>

      <main class="login-form">
        <div class="welcome-card">
          <div class="character-preview">
            <div class="character-simple">üëµ</div>
          </div>

          <h2>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö!</h2>
          <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°</p>

          <form id="login-form">
            <div class="input-group">
              <label for="player-name">‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</label>
              <input
                type="text"
                id="player-name"
                name="playerName"
                placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..."
                required
                minlength="2"
                maxlength="20"
              />
            </div>

            <button type="submit" class="btn btn-primary btn-large">
              ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°
            </button>
          </form>
        </div>
      </main>

      <footer class="footer">
        <p>‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏™‡∏°‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</p>
      </footer>
    </div>
  </div>

  <!-- ‡∏´‡∏ô‡πâ‡∏≤ Dashboard -->
  <div id="dashboard-page" class="page">
    <div class="container">
      <header class="header">
        <h1>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ <span id="display-name">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</span>! üëã</h1>
        <button class="btn btn-ghost logout-btn" style="position:absolute; top:20px; right:20px;">
          ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
        </button>
      </header>

      <main class="dashboard-content">
        <section class="character-section">
          <div id="character-display-area">
            <!-- Ragnarok Character ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÇ‡∏î‡∏¢ JavaScript -->
            <div class="character-loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£... ‚ö°</div>
          </div>
        </section>

        <!-- Action Buttons -->
        <section class="action-buttons">
          <div class="action-grid">
            <button class="action-card shop-card" id="open-shop">
              <div class="action-icon">üõí</div>
              <h3>‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
              <p>‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</p>
            </button>

            <button class="action-card games-card" id="open-games">
              <div class="action-icon">üéÆ</div>
              <h3>‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°</h3>
              <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏≤‡∏ò‡∏¥</p>
            </button>

            <button class="action-card stats-card" id="view-stats">
              <div class="action-icon">üìä</div>
              <h3>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h3>
              <p>‡∏î‡∏π‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
            </button>

            <button class="action-card customize-card" id="customize-character">
              <div class="action-icon">‚ú®</div>
              <h3>‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß</h3>
              <p>‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
            </button>
          </div>
        </section>

        <!-- Mini Games Selection -->
        <section class="games-menu" id="games-selection" style="display:none;">
          <div class="games-header">
            <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</h2>
            <button class="btn btn-secondary back-to-main">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
          </div>

          <div class="games-grid">
            <button class="game-card memory-game" data-game="memory">
              <div class="game-icon">üß©</div>
              <h3>‡πÄ‡∏Å‡∏°‡∏à‡∏≥‡∏†‡∏≤‡∏û</h3>
              <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô</p>
            </button>

            <button class="game-card pattern-game" data-game="pattern">
              <div class="game-icon">üîÑ</div>
              <h3>‡πÄ‡∏Å‡∏°‡∏à‡∏≥‡∏•‡∏≥‡∏î‡∏±‡∏ö</h3>
              <p>‡∏à‡∏≥‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏•‡∏≥‡∏î‡∏±‡∏ö</p>
            </button>

            <button class="game-card addtion-game" data-game="addition">
              <div class="game-icon">üßÆ</div>
              <h3>‡πÄ‡∏Å‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡πá‡∏ß</h3>
              <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ô</p>
            </button>

            <button class="game-card logic-game" data-game="logic">
              <div class="game-icon">üí≠</div>
              <h3>‡πÄ‡∏Å‡∏°‡∏ï‡∏£‡∏£‡∏Å‡∏∞</h3>
              <div class="game-difficulty">‡∏¢‡∏≤‡∏Å</div>
            </button>
          </div>
        </section>

        <!-- Shop Section -->
        <section class="shop-menu" id="shop-section" style="display:none;">
          <div class="shop-header">
            <h2>‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
            <div class="player-coins">
              <span class="coin-icon">‚≠ê</span>
              <span id="player-coins">0</span> ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç
            </div>
            <button class="btn btn-secondary back-to-main">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
          </div>
          <div class="shop-items" id="shop-items"><!-- ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢ JS --></div>
        </section>

      
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="loading-spinner"></div>
    <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
  </div>

    <!-- JavaScript Files -->
  <script type="module">
    import * as Constants from '/js/utils/constants.js';
    import * as Storage from '/js/utils/storage.js';
    // ‡πÇ‡∏¢‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ global ‡πÉ‡∏´‡πâ‡πÑ‡∏ü‡∏•‡πå non-module ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
    window.Constants = Constants;
    window.Storage = Storage;
  </script>

  <script src="js/utils/helpers.js"></script>
  <script src="js/dataManager.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/character.js"></script>
  <script src="js/economy-unified.js"></script>
  <script src="js/inventory-enhanced.js"></script>
  <script src="js/app.js"></script>
  
  <style id="bigger-emotion-effects">
  /* ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô + ‡∏•‡∏≠‡∏¢‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏¥‡∏î ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ö‡∏´‡∏±‡∏ß */
  #image-character-container .effect-hearts,
  #image-character-container .effect-sparkles,
  #image-character-container .effect-thought,
  #image-character-container .effect-love{
    font-size: 2.4rem !important;   /* ‡πÄ‡∏î‡∏¥‡∏° ~1rem */
    top: -48px !important;          /* ‡∏Ç‡∏¢‡∏±‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
    text-shadow: 0 2px 6px rgba(0,0,0,.12);
  }

  /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏•‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏°‡∏µ‡∏°‡∏¥‡∏ï‡∏¥‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô */
  #image-character-container @keyframes effectFloat{
    0%,100%{ transform: translateX(-50%) translateY(0);    opacity:1 }
    50%   { transform: translateX(-50%) translateY(-22px); opacity:.85 }
  }

  /* ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠: ‡∏¢‡∏±‡∏á‡πÉ‡∏´‡∏ç‡πà ‡πÅ‡∏ï‡πà‡∏•‡∏î‡∏ô‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å */
  @media (max-width:768px){
    #image-character-container .effect-hearts,
    #image-character-container .effect-sparkles,
    #image-character-container .effect-thought,
    #image-character-container .effect-love{
      font-size: 2.1rem !important;
      top: -42px !important;
    }
  }
</style>
<script>
/* ==== CHARACTER LAYOUT + PET SLOT + FORM GUARD (drop-in) ==== */
(function () {
  /* 0) ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏° Welcome ‡πÄ‡∏î‡πâ‡∏á 404 (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°") */
  document.addEventListener('submit', function (e) {
    var f = e.target;
    if (!f || f.tagName !== 'FORM') return;
    // ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ action ‡∏´‡∏£‡∏∑‡∏≠ action ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏° ‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏¢‡∏¥‡∏á GET ‡πÅ‡∏•‡πâ‡∏ß 404
    var action = (f.getAttribute('action') || '').trim();
    if (action === '' || action === '#' || action === window.location.pathname) {
      e.preventDefault();
      var nameInput = f.querySelector('input[name="playerName"], input[type="text"]');
      var val = (nameInput && nameInput.value || '').trim();
      if (!val) { try { f.reportValidity && f.reportValidity(); } catch(_){} return; }
      try { localStorage.setItem('playerName', val); } catch(_) {}
      // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
      if (window.startGame) { window.startGame(val); }
      // ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Æ‡∏°‡∏î‡πâ‡∏ß‡∏¢ hash (‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á 404)
      else { location.hash = '#/home'; }
    }
  }, true);

  /* 1) ‡∏â‡∏µ‡∏î CSS (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏™‡πÑ‡∏ï‡∏•‡πå) */
  var css = `
  .character-stage{
    position: relative !important;
    display: flex !important;
    align-items: center !important;      /* ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
    justify-content: space-between !important;
    min-height: 260px !important;
  }
  .character-nameplate{
    position: absolute !important;
    inset: 16px auto auto 24px !important; /* top right bottom left */
    margin: 0 !important;
    text-align: left !important;
    z-index: 5 !important;
  }
  .character-art{
    position: relative !important;
    display: inline-block !important;
    align-self: center !important;
    margin-right: 28px !important;
  }
  .pet-slot{
    position: absolute !important;
    bottom: 0 !important;
    left: -24px !important;
    width: 96px !important; height: 96px !important;
    border-radius: 16px !important;
    background: rgba(255,255,255,0.65) !important;
    backdrop-filter: blur(4px) !important;
    box-shadow: 0 6px 16px rgba(0,0,0,0.12) !important;
    overflow: hidden !important;
    display: flex !important;
    align-items: flex-end !important;
    justify-content: center !important;
    z-index: 4 !important;
  }
  .pet-slot img{ max-width:100% !important; max-height:100% !important; object-fit:contain !important; display:block !important; }
  `;
  var style = document.createElement('style');
  style.appendChild(document.createTextNode(css));
  document.head.appendChild(style);

  /* 2) ‡∏à‡∏±‡∏î DOM ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö: ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ + ‡πÉ‡∏™‡πà‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á */
  function $(sel, root){ return (root||document).querySelector(sel); }
  function create(tag, cls){ var el=document.createElement(tag); if(cls) el.className=cls; return el; }

  var stage = $('.character-stage');
  var nameplate = $('.character-nameplate'); // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á

  // ‡∏´‡∏≤ <img> ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ id="characterImg" ‡∏à‡∏∞‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)
  var charImg = $('#characterImg') || (stage ? $('img', stage) : null);
  // ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ .character-art ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
  var charArt = $('.character-art');
  if (charImg && !charArt) {
    charArt = create('div', 'character-art');
    charImg.parentNode.insertBefore(charArt, charImg);
    charArt.appendChild(charImg);
  }
  // ‡πÉ‡∏™‡πà‡∏™‡∏•‡∏≠‡∏ï‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á
  var petSlot = $('#petSlot') || (charArt ? $('.pet-slot', charArt) : null);
  if (!petSlot && charArt) {
    petSlot = create('div', 'pet-slot'); petSlot.id = 'petSlot';
    petSlot.setAttribute('aria-label', 'pet');
    charArt.appendChild(petSlot);
  }

  /* 3) ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á: ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å /assets/pets ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á */
  var PET_STORAGE_KEY = 'currentPet';
  var PETS_ASSET_BASE = '/assets/pets/';       // ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏£‡∏π‡∏õ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
  var PET_CATALOG = {                          // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏à‡∏£‡∏¥‡∏á
    'dog-1': 'dog-1.png',
    'cat-1': 'cat-1.png',
    'bird-1': 'bird-1.png'
  };

  function resolvePetFile(pet){ return PET_CATALOG[pet] || pet || PET_CATALOG['dog-1']; }
  function renderPet(pet){
    if (!petSlot) return;
    var file = resolvePetFile(pet);
    petSlot.innerHTML = '';
    var img = new Image();
    img.alt = '‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á'; img.loading = 'lazy'; img.decoding = 'async';
    img.src = PETS_ASSET_BASE + file;
    petSlot.appendChild(img);
  }
  function setPet(pet){
    try { localStorage.setItem(PET_STORAGE_KEY, pet); } catch(_){}
    renderPet(pet);
  }

  // init ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
  var saved = null; try { saved = localStorage.getItem(PET_STORAGE_KEY); } catch(_){}
  renderPet(saved || 'dog-1');

  // hook ‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤: ‡∏¢‡∏¥‡∏á‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á
  // window.dispatchEvent(new CustomEvent('shop:petChange', { detail: { pet: 'cat-1' } }));
  window.addEventListener('shop:petChange', function (ev) {
    var p = ev && ev.detail && ev.detail.pet;
    if (p) setPet(p);
  });

  // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏î‡∏µ‡∏ö‡∏±‡∏Å‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏ã‡∏•
  window.setPet = setPet;
})();
</script>

</body>
</html>
