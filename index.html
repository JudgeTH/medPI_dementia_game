  <!-- JavaScript Files - ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç! -->
  <!-- 1. ‡πÇ‡∏´‡∏•‡∏î Items ‡∏Å‡πà‡∏≠‡∏ô -->
  <script src="/data/items.js"></script>
  
  <!-- 2. ‡πÇ‡∏´‡∏•‡∏î Utils -->
  <script src="js/utils/constants.js"></script>
  <script src="js/utils/helpers.js"></script>
  <script src="js/utils/storage.js"></script>
  
  <!-- 3. ‡πÇ‡∏´‡∏•‡∏î Core Systems -->
  <script src="js/dataManager.js"></script>
  <script src="js/auth.js"></script>
  
  <!-- 4. ‡πÇ‡∏´‡∏•‡∏î Character System (‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Avatar ‡πÄ‡∏ï‡πá‡∏°‡∏ï‡∏±‡∏ß) -->
  <script src="js/character.js"></script>
  
  <!-- 5. ‡πÇ‡∏´‡∏•‡∏î Main App -->
  <script src="js/app.js"></script>

  <script>
    // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î Avatar ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°‡∏ï‡∏±‡∏ß
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üéÆ Initializing game...');
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÇ‡∏´‡∏•‡∏î items.js ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
      if (window.SHOP_ITEMS) {
        console.log('‚úÖ Items loaded:', window.SHOP_ITEMS.length);
      } else {
        console.warn('‚ö†Ô∏è Items not loaded');
      }
      
      // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ default avatar
      setTimeout(function() {
        if (window.characterSystem && window.characterSystem.isInitialized) {
          const userId = localStorage.getItem('ecg_current_uid') || 'guest';
          const gender = localStorage.getItem('player_gender') || 'male';
          const displayName = localStorage.getItem('player_name') || '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô';
          
          const userData = {
            userId: userId,
            displayName: displayName,
            character: {
              avatarId: gender === 'female' ? 'elderly_female_base' : 'elderly_male_base'
            },
            stats: {
              totalStars: 0,
              totalGames: 0
            }
          };
          
          window.characterSystem.loadCharacter(userData);
          console.log('‚úÖ Character loaded with avatarId:', userData.character.avatarId);
        }
      }, 500);
    });
  </script><!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#4CAF50" />

  <!-- PWA Meta Tags -->
  <link rel="manifest" href="manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="‡πÄ‡∏Å‡∏°‡∏ù‡∏∂‡∏Å‡∏™‡∏°‡∏≠‡∏á" />

  <title>‡πÄ‡∏Å‡∏°‡∏ù‡∏∂‡∏Å‡∏™‡∏°‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</title>

  <!-- CSS Files -->
  <link rel="stylesheet" href="css/reset.css" />
  <link rel="stylesheet" href="css/variables.css" />
  <link rel="stylesheet" href="css/base.css" />
  <link rel="stylesheet" href="css/components.css" />
  <link rel="stylesheet" href="css/animations.css" />
  <link rel="stylesheet" href="css/responsive.css" />

  <!-- Combined UI Hotfix -->
  <style>
    /* Character layout: info ‡∏ã‡πâ‡∏≤‡∏¢ / ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ ‡∏Ç‡∏ß‡∏≤ */
    #image-character-container .character-display-area,
    #character-container-wrapper .character-display{
      display:flex;
      justify-content:space-between;
      align-items:center;
      width:92%;
      max-width:980px;
      padding:0 16px;
    }
    #image-character-container .character-info.in-stage,
    #character-container-wrapper .character-info{ 
      order:1; 
      text-align:left; 
      max-width:240px; 
    }
    #image-character-container .character-container,
    #character-container-wrapper .avatar-container{ 
      order:2; 
      width:220px !important; 
      height:330px !important; 
    }

    /* ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô */
    #image-character-container .character-nameplate h3,
    #character-container-wrapper .nameplate h3{ 
      font-size:3.5rem !important; 
      letter-spacing:.2px; 
    }

    /* ‡πÅ‡∏ñ‡∏ß‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ */
    #image-character-container .character-stats,
    #character-container-wrapper .stats{ gap:10px !important; }
    #image-character-container .stat-item,
    #character-container-wrapper .stat{ font-size:1.1rem !important; }
    #image-character-container .stat-icon,
    #character-container-wrapper .stat-icon{
      font-size:1.6rem !important;
      min-width:26px !important;
    }
    #image-character-container .stat-label,
    #character-container-wrapper .stat-label{ font-weight:600; }
    #image-character-container .stat-value,
    #character-container-wrapper .stat-value{ font-size:1.35rem !important; }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå */
    #image-character-container .emotion-controls,
    #character-container-wrapper .emotion-controls{ gap:12px !important; }
    #image-character-container .emotion-btn,
    #character-container-wrapper .emotion-btn{
      width:52px !important;
      height:52px !important;
      font-size:1.35rem !important;
    }

    /* ‡∏ï‡∏±‡∏î‡πÄ‡∏á‡∏≤ + ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ */
    #image-character-container .character-shadow,
    #character-container-wrapper .character-shadow{ display:none !important; }
    #image-character-container .character-container,
    #character-container-wrapper .avatar-container{
      width:240px !important;
      height:360px !important;
    }

    /* ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ß‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏Å‡∏≤‡∏£‡πå‡∏î */
    .action-buttons{ padding-left:16px !important; padding-right:16px !important; }
    .action-grid{
      display:grid !important;
      grid-template-columns:repeat(2,1fr) !important;
      gap:16px !important;
    }
    .action-card{
      min-height:140px !important;
      padding:16px 14px !important;
      border-radius:16px !important;
      box-shadow:0 2px 8px rgba(0,0,0,.06) !important;
      background-color: #EAF4FF !important;
      border: 1px solid #CFE3FF !important;
    }
    .action-card .action-icon{
      font-size:2.2rem !important;
      margin-bottom:10px !important;
      line-height:1 !important;
      opacity: 1 !important;
    }
    .action-card h3{ 
      font-size:1.3rem !important; 
      margin:6px 0 4px !important;
      color: #0A2540 !important;
    }
    .action-card p{ 
      font-size:.95rem !important; 
      color: #1F2A44 !important;
      opacity: 1 !important;
    }
    .action-card:hover{
      background-color: #E3F0FF !important;
      transform: translateY(-1px);
      transition: all .2s ease;
      box-shadow: 0 6px 18px rgba(14, 35, 69, 0.12) !important;
    }

    /* Emotion effects ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô */
    #image-character-container .effect-hearts,
    #image-character-container .effect-sparkles,
    #image-character-container .effect-thought,
    #image-character-container .effect-love,
    #character-container-wrapper .effect-hearts,
    #character-container-wrapper .effect-sparkles,
    #character-container-wrapper .effect-thought,
    #character-container-wrapper .effect-love{
      font-size: 2.4rem !important;
      top: -48px !important;
      text-shadow: 0 2px 6px rgba(0,0,0,.12);
    }

    /* Mobile */
    @media (max-width:768px){
      #image-character-container,
      #character-container-wrapper{ height:480px !important; }
      #image-character-container .character-container,
      #character-container-wrapper .avatar-container{
        width:220px !important;
        height:330px !important;
      }
      #image-character-container .character-nameplate h3,
      #character-container-wrapper .nameplate h3{ font-size:2.35rem !important; }
      #image-character-container .stat-item,
      #character-container-wrapper .stat{ font-size:1.05rem !important; }
      #image-character-container .stat-icon,
      #character-container-wrapper .stat-icon{ font-size:1.5rem !important; min-width:24px !important; }
      #image-character-container .stat-value,
      #character-container-wrapper .stat-value{ font-size:1.3rem !important; }
      #image-character-container .emotion-btn,
      #character-container-wrapper .emotion-btn{
        width:48px !important; height:48px !important; font-size:1.25rem !important;
      }

      .action-buttons{ padding-left:18px !important; padding-right:18px !important; }
      .action-grid{ gap:14px !important; }
      .action-card{
        min-height:150px !important;
        padding:18px 16px !important;
      }
      .action-card .action-icon{ font-size:2.4rem !important; }
      .action-card h3{ font-size:1.35rem !important; }
      
      #image-character-container .effect-hearts,
      #image-character-container .effect-sparkles,
      #image-character-container .effect-thought,
      #image-character-container .effect-love,
      #character-container-wrapper .effect-hearts,
      #character-container-wrapper .effect-sparkles,
      #character-container-wrapper .effect-thought,
      #character-container-wrapper .effect-love{
        font-size: 2.1rem !important;
        top: -42px !important;
      }
    }
  </style>
</head>
<body>
  <!-- ‡∏´‡∏ô‡πâ‡∏≤ Login/Welcome -->
  <div id="login-page" class="page active">
    <div class="container">
      <header class="header">
        <h1 class="game-title">üß† ‡πÄ‡∏Å‡∏°‡∏ù‡∏∂‡∏Å‡∏™‡∏°‡∏≠‡∏á</h1>
        <p class="game-subtitle">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</p>
      </header>

      <main class="login-form">
        <div class="welcome-card">
          <div class="character-preview">
            <div class="character-simple">üëµ</div>
          </div>

          <h2>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö!</h2>
          <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°</p>

          <form id="login-form">
            <div class="input-group">
              <label for="player-name">‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</label>
              <input
                type="text"
                id="player-name"
                name="playerName"
                placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..."
                required
                minlength="2"
                maxlength="20"
              />
            </div>

            <button type="submit" class="btn btn-primary btn-large">
              ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°
            </button>
          </form>
        </div>
      </main>

      <footer class="footer">
        <p>‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏™‡∏°‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</p>
      </footer>
    </div>
  </div>

  <!-- ‡∏´‡∏ô‡πâ‡∏≤ Dashboard -->
  <div id="dashboard-page" class="page">
    <div class="container">
      <header class="header">
        <h1>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ <span id="display-name">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</span>! üëã</h1>
        <button class="btn btn-ghost logout-btn" style="position:absolute; top:20px; right:20px;">
          ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
        </button>
      </header>

      <main class="dashboard-content">
        <section class="character-section">
          <!-- üÜï Character mount point ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà -->
          <div id="character-mount-point"></div>
          <div id="character-display-area">
            <div class="character-loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£... ‚ö°</div>
          </div>
        </section>

        <!-- Action Buttons -->
        <section class="action-buttons">
          <div class="action-grid">
            <button class="action-card shop-card" id="open-shop">
              <div class="action-icon">üõí</div>
              <h3>‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
              <p>‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</p>
            </button>

            <button class="action-card games-card" id="open-games">
              <div class="action-icon">üéÆ</div>
              <h3>‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°</h3>
              <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏≤‡∏ò‡∏¥</p>
            </button>

            <button class="action-card stats-card" id="view-stats">
              <div class="action-icon">üìä</div>
              <h3>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h3>
              <p>‡∏î‡∏π‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
            </button>

            <button class="action-card customize-card" id="customize-character">
              <div class="action-icon">‚ú®</div>
              <h3>‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß</h3>
              <p>‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
            </button>
          </div>
        </section>

        <!-- Mini Games Selection -->
        <section class="games-menu" id="games-selection" style="display:none;">
          <div class="games-header">
            <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</h2>
            <button class="btn btn-secondary back-to-main">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
          </div>

          <div class="games-grid">
            <button class="game-card memory-game" data-game="memory">
              <div class="game-icon">üß©</div>
              <h3>‡πÄ‡∏Å‡∏°‡∏à‡∏≥‡∏†‡∏≤‡∏û</h3>
              <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô</p>
            </button>

            <button class="game-card pattern-game" data-game="pattern">
              <div class="game-icon">üîÑ</div>
              <h3>‡πÄ‡∏Å‡∏°‡∏à‡∏≥‡∏•‡∏≥‡∏î‡∏±‡∏ö</h3>
              <p>‡∏à‡∏≥‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏•‡∏≥‡∏î‡∏±‡∏ö</p>
            </button>

            <button class="game-card addtion-game" data-game="addition">
              <div class="game-icon">üßÆ</div>
              <h3>‡πÄ‡∏Å‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡πá‡∏ß</h3>
              <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ô</p>
            </button>

            <button class="game-card logic-game" data-game="logic">
              <div class="game-icon">üí≠</div>
              <h3>‡πÄ‡∏Å‡∏°‡∏ï‡∏£‡∏£‡∏Å‡∏∞</h3>
              <div class="game-difficulty">‡∏¢‡∏≤‡∏Å</div>
            </button>
          </div>
        </section>

        <!-- Shop Section -->
        <section class="shop-menu" id="shop-section" style="display:none;">
          <div class="shop-header">
            <h2>‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
            <div class="player-coins">
              <span class="coin-icon">‚≠ê</span>
              <span id="player-coins">0</span> ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç
            </div>
            <button class="btn btn-secondary back-to-main">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
          </div>

          <div class="shop-categories">
            <button class="shop-tab active" data-category="clothes">üëï ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤</button>
            <button class="shop-tab" data-category="accessories">üëí ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏î‡∏±‡∏ö</button>
            <button class="shop-tab" data-category="pets">üêï ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</button>
          </div>

          <div class="shop-items" id="shop-items"></div>
        </section>
      </main>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="loading-spinner"></div>
    <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
  </div>

  <!-- üÜï JavaScript Files - ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç! -->
  <!-- 1. ‡πÇ‡∏´‡∏•‡∏î Items ‡∏Å‡πà‡∏≠‡∏ô -->
  <script src="/data/items.js"></script>
  
  <!-- 2. ‡πÇ‡∏´‡∏•‡∏î Utils -->
  <script src="js/utils/constants.js"></script>
  <script src="js/utils/helpers.js"></script>
  <script src="js/utils/storage.js"></script>
  
  <!-- 3. ‡πÇ‡∏´‡∏•‡∏î Core Systems (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ module ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ character.js ‡πÄ‡∏Å‡πà‡∏≤‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà) -->
  <script src="js/dataManager.js"></script>
  <script src="js/auth.js"></script>
  
  <!-- 4. ‡πÇ‡∏´‡∏•‡∏î Character System ‡πÅ‡∏ö‡∏ö‡πÄ‡∏Å‡πà‡∏≤ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö backward compatibility) -->
  <script type="module" src="js/character.js"></script>
  
  <!-- 5. üÜï ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ module ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ) -->
  <script src="js/character-simple-nomodule.js"></script>
  <script src="js/economy-unified-nomodule.js"></script>
  <script src="js/inventory-enhanced-nomodule.js"></script>
  
  <!-- 6. ‡πÇ‡∏´‡∏•‡∏î Main App ‡πÅ‡∏•‡∏∞ Loader -->
  <script src="js/app.js"></script>
  <script src="js/main.js"></script>

</body>
</html>
